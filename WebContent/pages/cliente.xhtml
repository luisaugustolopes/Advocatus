<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="/WEB-INF/templates/template-menu.xhtml" 
    xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:define name="head">
	<title>Advocatus - Novo cliente</title>
</ui:define>

<ui:define name="body">

	
	<h:form  id="formPrincipal">
	
				
				<p:panel id="panel"
					header="Cadastro Cliente - Informe os dados abaixo"
					style="margin-bottom:10px;">

					<h:panelGrid columns="2">
						<h:outputText value="Tipo de Pessoa:" />
						<p:selectOneRadio id="radioB" value="#{pessoaBean.tipoPessoa}">
							<f:selectItem itemLabel="Pessoa Física" itemValue="F" />
							<f:selectItem itemLabel="Pessoa Jurídica" itemValue="J" />
							<p:ajax update="@form" event="change" immediate="true" />
						</p:selectOneRadio>
					</h:panelGrid>


				</p:panel>
				<p:outputPanel id="panelPF">
					<p:panel header="Pessoa Física"
						rendered="#{pessoaBean.isPessoaFisica()}">
						<h:panelGrid columns="2">
							<h:outputLabel value="ID:" />
							<h:outputLabel value="#{pessoaBean.fisica.id}" />

							<h:outputLabel for="cpf" value="CPF:" />
							<p:inputMask mask="999.999.999-99" id="cpf"
								value="#{pessoaBean.fisica.cpf}" required="true"
								requiredMessage=" Informe o CPF"
								validator="#{pessoaBean.validate}">
								<p:ajax update="@form" event="blur" />
							</p:inputMask>

							<h:outputLabel value="Nome:" />
							<p:inputText value="#{pessoaBean.fisica.nome}" required="true"
								requiredMessage="Informe o Nome" />

							<h:outputLabel value="E-mail:" />
							<p:inputText value="#{pessoaBean.fisica.email}" />

							<h:outputLabel for="sexo" value="Sexo:" />
							<p:selectOneRadio id="sexo" value="#{pessoaBean.fisica.sexo}"
								required="true" requiredMessage="Informe o Sexo">
								<f:selectItem itemLabel="Masculino" itemValue="M" />
								<f:selectItem itemLabel="Feminino" itemValue="F" />
							</p:selectOneRadio>

							<h:outputLabel for="dataNascimento" value="Data Nascimento:" />
							<p:calendar value="#{pessoaBean.fisica.dataNascimento}"
								id="dataNascimento" showOn="button" pattern="dd/MM/yyyy">
							</p:calendar>

						</h:panelGrid>

					</p:panel>
				</p:outputPanel>


				<p:outputPanel id="panelPJ">
					<p:panel header="Pessoa Jurídica"
						rendered="#{pessoaBean.isPessoaJuridica()}">

						<h:panelGrid columns="2">
							<h:outputLabel value="ID:" />
							<h:outputLabel value="#{pessoaBean.juridica.id}" />

							<h:outputLabel for="cnpj" value="CNPJ:" />
							<p:inputMask mask="99.999.999/9999-99" id="cnpj"
								value="#{pessoaBean.juridica.cnpj}" />

							<h:outputLabel value="Nome:" />
							<p:inputText value="#{pessoaBean.juridica.nome}" />

							<h:outputLabel value="E-mail:" />
							<p:inputText value="#{pessoaBean.fisica.email}" />

						</h:panelGrid>
					</p:panel>
				</p:outputPanel>


	<!--******************************* 
		Panel Telefone / Endereço
	***********************************-->
				<p:accordionPanel id="panelExtra">
					<!-- TELEFONES -->
					<p:tab title="Telefone" id="tabTelefone">

						<!-- Inclusão de telefone do novo cliente -->
						<h:panelGrid id="gridTelefone" columns="3"
							rendered="#{pessoaBean.novoCliente}">
							<h:outputLabel value="Telefone (DDD/Número)" />
							<p:inputText value="#{telefoneBean.getTelefoneCadastro()[0].ddd}" />
							<p:inputText
								value="#{telefoneBean.getTelefoneCadastro()[0].numero}" />

							<h:outputLabel value="Celular (DDD/Número)" />
							<p:inputText value="#{telefoneBean.getTelefoneCadastro()[1].ddd}" />
							<p:inputText
								value="#{telefoneBean.getTelefoneCadastro()[1].numero}" />
						</h:panelGrid>


						<h:panelGrid columns="7" rendered="#{not pessoaBean.novoCliente}">
							<h:outputLabel value="DDD:" />
							<p:inputText value="#{telefoneBean.telefone.ddd}" size="3" />
							<h:outputLabel value="Número:" />
							<p:inputText value="#{telefoneBean.telefone.numero}" />
							<h:outputLabel value="Tipo:" style="margin-left:10px" />
							<p:selectOneRadio value="#{telefoneBean.telefone.tipo}">
								<f:selectItem itemLabel="Fixo" itemValue="0" />
								<f:selectItem itemLabel="Celular" itemValue="1" />
							</p:selectOneRadio>
							<ui:remove>
							<p:commandButton value="Adicionar"
								actionListener="#{telefoneBean.inserir}" update="dtableTelefone">
								<f:param name="idPessoa" value="#{pessoaBean.getPessoaID()}" />
							</p:commandButton>
							</ui:remove>
						</h:panelGrid>

						<!-- Edição dos telefones do cliente -->
						<p:dataTable id="dtableTelefone" var="telefone"
							value="#{telefoneBean.telefones}" editable="true"
							rendered="#{not pessoaBean.novoCliente}">
							<p:column>
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{telefone.ddd}" />-<h:outputText
											value="#{telefone.numero}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{telefone.ddd}" style="width:30px" />-<p:inputText
											value="#{telefone.numero}" style="width:90px" />
									</f:facet>
								</p:cellEditor>
							</p:column>

							<p:column style="width:6%">
								<p:rowEditor />
							</p:column>

							<p:column style="width:6%">
								<p:commandLink id="lnkExcluirFone" title="Excluir"
									update="dtableTelefone"
									action="#{telefoneBean.setTelefone(telefone)}"
									onclick="dialogExcluirTelefone.show()" 
									styleClass="ui-icon ui-icon-circle-close">
								</p:commandLink>
							</p:column>
						</p:dataTable>
					</p:tab>
				</p:accordionPanel>

				<p:commandButton id="btnVoltar" ajax="false" value="Voltar"
					action="lista-clientes?faces-redirect=true" immediate="true" />
				
				<p:commandButton id="btnGravarPF" ajax="false" value="Gravar"
					action="#{pessoaBean.inserir(pessoaBean.fisica)}"
					rendered="#{pessoaBean.isPessoaFisica()}" />
				
				<p:commandButton id="btnGravarPJ" ajax="false" value="Gravar"
					action="#{pessoaBean.inserir(pessoaBean.juridica)}"
					rendered="#{pessoaBean.isPessoaJuridica()}" />
				
				<p:commandButton id="btnExcluirPessoa" ajax="false" value="Excluir"
					action="#{pessoaBean.deletar()}" />
				<h:messages id="msgs" />
		</h:form>

</ui:define>

<ui:define name="dialogs">
<!--******************************* 
	Excluir Pessoa
***********************************-->
<p:confirmDialog id="dlgExcluirPessoa"
		message="Confirma a exclusão do cliente ?"
        header="Excluir"
        severity="alert"
        widgetVar="dialogExcluirPessoa"
        closeOnEscape="true">
        
	    <p:commandButton value="Sim"
                oncomplete="dialogExcluirPessoa.hide()"                
                action="#{telefoneBean.deletar}"
                styleClass="ui-confirmdialog-yes">
		</p:commandButton>
                
        <p:commandButton value="Não"
                onclick="dialogExcluirPessoa.hide()" 
                styleClass="ui-confirmdialog-no"/>
</p:confirmDialog>	
	
	
<!--******************************* 
	Excluir Telefone
***********************************-->
<p:confirmDialog id="dlgExcluirTelefone"
		message="Confirma a exclusão do telefone ?"
        header="Excluir"
        severity="alert"
        widgetVar="dialogExcluirTelefone"
        closeOnEscape="true">
        
	    <p:commandButton value="Sim" immediate="true"
                oncomplete="dialogExcluirTelefone.hide()"
                update=":formPrincipal:panelExtra"
                actionListener="#{telefoneBean.deletar}"
                styleClass="ui-confirmdialog-yes">
		</p:commandButton>
                
        <p:commandButton id="decline" value="Não"
                onclick="dialogExcluirTelefone.hide()" 
                styleClass="ui-confirmdialog-no"/>
</p:confirmDialog>	
	
</ui:define>

</ui:composition>